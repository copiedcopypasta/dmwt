name: Generate Changelog

# Trigger: Runs when a GitHub Release is created or edited
# Updates CHANGELOG.md based on conventional commits between releases
# Commits are categorized according to the TYPE mapping below
on:
  release:
    types: [created, edited]

jobs:
  update-changelog:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Required to commit CHANGELOG.md updates
    steps:
      # Checkout with full history for accurate changelog generation
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Generate and commit CHANGELOG.md updates
      # Categorizes commits based on conventional commit prefixes
      - name: Auto-generate CHANGELOG
        uses: BobAnkh/auto-generate-changelog@v1.3.0
        with:
          ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PATH: CHANGELOG.md
          COMMIT_MESSAGE: 'docs(CHANGELOG): update release notes'
          # Mapping: commit-prefix:Section Title (aligns with .github/release.yml)
          TYPE: 'feat:Features,fix:Bug Fixes,security:Security,build:Infrastructure & CI,test:Tests,chore:Maintenance,docs:Documentation,refactor:Refactor,perf:Performance Improvements,style:Styles'
