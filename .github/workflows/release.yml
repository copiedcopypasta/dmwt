name: Create Release

# Trigger: Runs when a version tag is pushed (e.g., v1.0.0, v2.1.3-beta)
# Creates a GitHub Release with auto-generated release notes based on .github/release.yml
# Pre-releases are detected by checking for alpha/beta/rc suffixes
on:
  push:
    tags:
      - 'v*.*.*' # Matches stable versions: v1.0.0, v2.1.3
      - 'v*.*.*-*' # Matches pre-releases: v1.0.0-alpha, v2.1.0-rc.1

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Required to create releases
    steps:
      # Checkout with full history for accurate release notes generation
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      # Detect if this is a pre-release based on tag format
      - name: Check if pre-release
        id: prerelease
        run: |
          if [[ "${GITHUB_REF_NAME}" =~ -[a-zA-Z] ]]; then
            echo "is_prerelease=true" >> $GITHUB_OUTPUT
          else
            echo "is_prerelease=false" >> $GITHUB_OUTPUT
          fi

      # Create GitHub Release with auto-generated notes
      # Uses .github/release.yml for categorization
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          generate_release_notes: true
          prerelease: ${{ steps.prerelease.outputs.is_prerelease }}
          token: ${{ secrets.GITHUB_TOKEN }}
